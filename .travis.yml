language: python

python:
  - "2.7"

notifications:
  email:
    on_success: always

install: pip install -r requirements/test.txt
script: python manage.py test

after_success:
  # check for pull request and correct python version
  - if [[ "$TRAVIS_PULL_REQUEST" == "true" ]]; then exit 0; fi
  - if [[ "$TRAVIS_PYTHON_VERSION" != "2.7" ]]; then exit 0; fi

  # Install heroku toolbelt
  - wget -qO- https://toolbelt.heroku.com/install-ubuntu.sh | sh

  # check branch to conditionally add remote repo
  - REPO_NAME=`basename $TRAVIS_REPO_SLUG`
  - if [[ "$TRAVIS_BRANCH" == "master" ]]; then git remote add production git@heroku.com:${REPO_NAME}.git; fi
  - if [[ "$TRAVIS_BRANCH" == "features" ]]; then git remote add staging git@heroku.com:${REPO_NAME}-stage.git; fi

  # Turn off warnings about SSH keys:
  - echo "Host heroku.com" >> ~/.ssh/config
  - echo "   StrictHostKeyChecking no" >> ~/.ssh/config
  - echo "   CheckHostIP no" >> ~/.ssh/config
  - echo "   UserKnownHostsFile=/dev/null" >> ~/.ssh/config
  - heroku keys:clear
  - yes | heroku keys:add

  # check branch for conditional push
  - if [[ "$TRAVIS_BRANCH" == "master" ]]; then yes | git push production master; fi
  - if [[ "$TRAVIS_BRANCH" == "features" ]]; then yes | git push staging features:master; fi

env:
  global:
  - secure: iEsaA6sDaV4NDGD6H6ivmr04UMmnMAclzEqesuB/lg/ge7xhYqwmpFuQXI1ZnojrUP4kWfNlAUitNa4CQxxA0iPnHAsnmSXPv9h7K/iltL99CiyKA6xZ0c675p1O/OI4Efe7tKaOKdEXz4I8uPbxxGVTMVpH4/TQJqwpSnFwhGM=
  - secure: kCSKZw4q5aHCDqkFf277dupkgfx1rLPJq2HPKMWTQU+n+aDm6FsVc6R6e0Y5mzseaj6lKyAwwriCH/+jYUejSLP4hoa4MhvIxIYrOar9YjEG8Gj0Xix6T8Cxli2AHF6jxktBjokegLguYhYR3tCyJw4MWMRLl7Gg+bbaYRjhQAE=
  - secure: ZcsuZAHwhD0S3by2L88vH0FVM6vo3gTyilD4LGi8YmRH+XMP6UFj5cxnlSRBqNdVuJJeoAIsVFhudtuJ/mi6keT8NCCAg68HPgTsdkE0qXHx55+O+P2eOgeDJfbzPgy6o5cU8yMpWmOnLBs1e09fbk5A/HIzWd9g+qF+VP1ZbOg=
